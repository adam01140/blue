<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Connection Form</title>
  <style>
    :root{
      --bg1:#eef3ff;
      --bg2:#ffffff;
      --card:#ffffffcc;
      --ink:#0f172a;
      --muted:#5b6475;
      --accent:#0A66C2;
      --accent-2:#6aa9ff;
      --ring:#0a66c23d;
      --line:#e6eaf1;
      --ok:#22c55e;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 700px at 20% -10%, #dfeaff 0%, #f6f9ff 45%, #ffffff 70%) no-repeat,
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding:32px 20px;
    }

    .page{
      max-width:1050px;
      margin:0 auto;
    }

    .form-shell{
      background:var(--card);
      backdrop-filter:saturate(1.2) blur(8px);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: 0 10px 30px rgba(16,24,40,.08);
      overflow:hidden;
    }

    header.hero{
      padding:28px 28px 18px;
      background:
        linear-gradient(180deg, #ffffffcc, #ffffffaa),
        radial-gradient(1200px 600px at 80% -40%, #b8d8ff55, transparent 60%),
        radial-gradient(900px 500px at 0% 0%, #9fd3ff44, transparent 60%);
      border-bottom:1px solid var(--line);
    }
    .title{
      margin:0 0 6px;
      font-size:28px;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:14.5px;
    }

    form{
      padding:26px;
    }

    .section{
      border:1px solid var(--line);
      border-radius:14px;
      padding:18px;
      margin-bottom:16px;
      background:#fff;
    }
    .section h2{
      margin:0 0 14px;
      font-size:15px;
      font-weight:700;
      color:#0b2a52;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .section h2::before{
      content:"";
      width:8px;height:8px;border-radius:999px;background:var(--accent);
      box-shadow:0 0 0 4px #0a66c21f;
    }

    .grid{
      display:grid;
      gap:14px;
    }
    /* responsive columns */
    .cols-2{grid-template-columns: repeat(2,minmax(0,1fr));}
    .cols-3{grid-template-columns: repeat(3,minmax(0,1fr));}
    .cols-4{grid-template-columns: repeat(4,minmax(0,1fr));}
    @media (max-width:980px){ .cols-4{grid-template-columns: repeat(3,minmax(0,1fr));} }
    @media (max-width:780px){
      .cols-4,.cols-3{grid-template-columns: repeat(2,minmax(0,1fr));}
    }
    @media (max-width:520px){
      .cols-4,.cols-3,.cols-2{grid-template-columns: 1fr;}
    }

    .field{
      display:flex; flex-direction:column; gap:6px;
    }
    label{
      font-size:12.5px;
      color:#334155;
      font-weight:600;
      letter-spacing:.15px;
    }
    input[type="text"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    input[type="email"],
    textarea,
    select{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:10px;
      background:#fff;
      font-size:14.5px;
      outline:none;
      transition:.15s border, .15s box-shadow;
    }
    textarea{min-height:92px; resize:vertical;}
    input:focus, textarea:focus, select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 4px var(--ring);
    }

    .inline{
      display:flex; gap:14px; flex-wrap:wrap; align-items:center;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border:1px solid var(--line); border-radius:999px; background:#fff;
      font-size:13.5px;
    }
    .chip input{transform:translateY(1px)}
    .muted{ color:var(--muted); font-size:12.5px;}

    .submit-btn{
      background:linear-gradient(180deg, var(--accent), #08498f);
      color:#fff; border:none; border-radius:12px;
      padding:14px 18px; font-size:16px; font-weight:700; letter-spacing:.2px;
      cursor:pointer; width:100%; margin-top:6px;
      box-shadow:0 8px 18px rgba(10,102,194,.22);
    }
    .submit-btn:hover{filter:brightness(1.05)}
    .submit-btn:disabled{background:#9dbbe2; box-shadow:none; cursor:not-allowed}

    .thank-you{
      display:none; text-align:center; padding:34px 26px;
    }
    .thank-you h2{ color:var(--ok); margin:0 0 10px; }
    .download-btn{
      background:#22c55e; color:#fff; border:none; border-radius:12px; padding:12px 20px;
      font-size:15px; cursor:pointer; margin-top:10px;
      box-shadow:0 8px 18px rgba(34,197,94,.22);
    }
    .download-btn:hover{filter:brightness(1.05)}
    .download-btn:disabled{background:#a7d9b8; box-shadow:none; cursor:not-allowed}

    /* Field Menu Styles */
    .field-menu {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: 0 20px 40px rgba(16,24,40,.15);
      backdrop-filter: saturate(1.2) blur(12px);
      padding: 20px;
      max-width: 500px;
      max-height: 70vh;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .field-menu.show {
      display: block;
      animation: fadeInScale 0.2s ease-out;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .field-menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--line);
    }

    .field-menu-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--ink);
      margin: 0;
    }

    .field-menu-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--muted);
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: background-color 0.15s;
    }

    .field-menu-close:hover {
      background: var(--line);
    }

    .field-list {
      display: grid;
      gap: 8px;
    }

    .field-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .field-item:hover {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--ring);
    }

    .field-item.copied {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: #16a34a;
      color: white;
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }

    .field-item.copied .field-id {
      color: white;
    }

    .field-item.copied .field-label {
      color: rgba(255, 255, 255, 0.9);
    }

    .field-item.copied .field-type {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .field-item.copied .copy-tooltip {
      background: rgba(255, 255, 255, 0.9);
      color: var(--ink);
    }

    .field-item.copied .copy-tooltip::after {
      border-top-color: rgba(255, 255, 255, 0.9);
    }

    /* Subtle pulse animation for the copied state */
    @keyframes copiedPulse {
      0% { transform: scale(1.02); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1.02); }
    }

    .field-item.copied {
      animation: copiedPulse 0.6s ease-in-out;
    }

    .field-id {
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: var(--accent);
      font-weight: 600;
    }

    .field-label {
      font-size: 12px;
      color: var(--muted);
      margin-left: 8px;
    }

    .field-type {
      font-size: 11px;
      color: var(--muted);
      background: var(--line);
      padding: 2px 6px;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .field-id {
      cursor: pointer;
      position: relative;
    }

    .field-id:hover {
      color: var(--accent-2);
    }

    .copy-tooltip {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 1001;
    }

    .copy-tooltip.show {
      opacity: 1;
    }

    .copy-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 4px solid transparent;
      border-top-color: var(--accent);
    }

    .field-menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      z-index: 999;
      display: none;
    }

    .field-menu-overlay.show {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .field-menu-search {
      margin-bottom: 16px;
    }

    .field-menu-search input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: #fff;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .field-menu-search input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--ring);
    }

    .field-menu-search input::placeholder {
      color: var(--muted);
    }

    .example-fill-btn {
      background: linear-gradient(180deg, #22c55e, #16a34a);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.2px;
      cursor: pointer;
      margin-top: 12px;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.22);
      transition: all 0.15s ease;
    }

    .example-fill-btn:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.3);
    }

    .example-fill-btn:active {
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="form-shell">
      <header class="hero">
        <h1 class="title">Connection Form</h1>
        <p class="subtitle">Enter the customer and service details below. When you submit, you'll be able to download a nicely formatted PDF.</p>
        <button type="button" id="exampleFillBtn" class="example-fill-btn" onclick="fillExampleData()">Example Fill</button>
      </header>

      <!-- Keep the same IDs and JS behavior -->
      <form id="customForm" onsubmit="return handleSubmit(event);">

     
        <!-- Top line -->
        <div class="section">
          <h2>Header</h2>
          <div class="grid cols-4">
            <div class="field"><label for="date_called">Date Called</label><input type="date" id="date_called" name="date_called"></div>
            <div class="field"><label for="date_wanted">Date Wanted</label><input type="date" id="date_wanted" name="date_wanted"></div>
            <div class="field"><label for="account_number">Account #</label><input type="text" id="account_number" name="account_number" placeholder="e.g., 123456"></div>
            <div class="field"><label for="wo_number">W/O #</label><input type="text" id="wo_number" name="wo_number" placeholder="Work order"></div>
          </div>
           <div class="grid cols-2" style="margin-top: 10px;">
             <div class="field"><label for="cycle_number">Cycle #</label><input type="text" id="cycle_number" name="cycle_number" placeholder="e.g., 3"></div>
             <div class="field"><label for="clerks_name">Clerk's Name</label><input type="text" id="clerks_name" name="clerks_name" value="Cynthia"></div>
           </div>
        </div>

        <!-- Contract Relationship -->
        <div class="section">
          <h2>Contract Relationship</h2>
          <div class="inline">
            <span class="muted">Relationship to Property:</span>
            <label class="chip"><input type="checkbox" id="owner" name="owner" value="yes"> Owner</label>
            <label class="chip"><input type="checkbox" id="tenant" name="tenant" value="yes"> Tenant</label>
            <label class="chip"><input type="checkbox" id="real_estate_agent" name="real_estate_agent" value="yes"> Real Estate Agent</label>
            <label class="chip"><input type="checkbox" id="property_manager" name="property_manager" value="yes"> Property Manager</label>
          </div>
        </div>

        <!-- Service Address & Type -->
        <div class="section">
          <h2>Service Address & Type</h2>
           <div class="grid cols-3">
             <div class="field"><label for="service_street">Street</label><input type="text" id="service_street" name="service_street" placeholder="Street address" onchange="updateFullServiceAddress()"></div>
             <div class="field"><label for="service_city">City</label><input type="text" id="service_city" name="service_city" value="SALINAS" onchange="updateFullServiceAddress()"></div>
             <div class="field"><label for="service_state">State</label><input type="text" id="service_state" name="service_state" value="CA" onchange="updateFullServiceAddress()"></div>
           </div>
          <div class="inline" style="margin-top:10px">
            <span class="muted">Service Type:</span>
            <label class="chip"><input type="radio" id="service_type_residential_single" name="service_type" value="residential_single"> RESL Single</label>
            <label class="chip"><input type="radio" id="service_type_residential_multi" name="service_type" value="residential_multi"> Multi</label>
            <label class="chip"><input type="radio" id="service_type_commercial" name="service_type" value="commercial"> Commercial</label>
          </div>
        </div>

        <!-- Proof of Occupancy -->
        <div class="section">
          <h2>Occupancy Documents</h2>
          <div class="inline">
            <label class="chip"><input type="checkbox" id="doc_rental" name="doc_rental" value="yes"> Rental agreement (1st page)</label>
            <label class="chip"><input type="checkbox" id="doc_rental_spanish" name="doc_rental_spanish" value="yes"> Contrato de Inquilino</label>
            <label class="chip"><input type="checkbox" id="doc_purchase" name="doc_purchase" value="yes"> Purchase – Closing/Est. Closing Costs</label>
            <label class="chip"><input type="checkbox" id="doc_purchase_spanish" name="doc_purchase_spanish" value="yes"> Cierra de Trato – Título</label>
          </div>
        </div>

        <!-- Customer -->
        <div class="section">
          <h2>Customer</h2>
          <div class="grid cols-3">
            <div class="field"><label for="first_name">First Name</label><input type="text" id="first_name" name="first_name"></div>
            <div class="field"><label for="middle_ex">MI / Ex</label><input type="text" id="middle_ex" name="middle_ex" placeholder="Optional"></div>
            <div class="field"><label for="last_name">Last Name</label><input type="text" id="last_name" name="last_name"></div>
          </div>
          <div class="grid cols-3" style="margin-top:6px">
            <div class="field"><label for="verify_cadl">Verify CADL / ID #</label><input type="text" id="verify_cadl" name="verify_cadl" placeholder="ID or CADL #"></div>
            <div class="field"><label for="last4_ssn">Last 4 SS#</label><input type="text" id="last4_ssn" name="last4_ssn" maxlength="4" inputmode="numeric" pattern="[0-9]{4}" placeholder="XXXX"></div>
            <div class="field"><label for="connect_date">Connect Date</label><input type="date" id="connect_date" name="connect_date"></div>
          </div>

          <div class="inline" style="margin-top:8px">
            <span class="muted">Last Bill?</span>
            <label class="chip"><input type="checkbox" id="last_bill" name="last_bill" value="yes"> Yes</label>
            <span class="muted" style="margin-left:10px;">Day of Week:</span>
            <label class="chip"><input type="radio" id="last_bill_dow_mon" name="last_bill_dow" value="MON"> MON</label>
            <label class="chip"><input type="radio" id="last_bill_dow_tue" name="last_bill_dow" value="TUE"> TUE</label>
            <label class="chip"><input type="radio" id="last_bill_dow_wed" name="last_bill_dow" value="WED"> WED</label>
            <label class="chip"><input type="radio" id="last_bill_dow_thu" name="last_bill_dow" value="THU"> THU</label>
            <label class="chip"><input type="radio" id="last_bill_dow_fri" name="last_bill_dow" value="FRI"> FRI</label>
          </div>

          <div class="grid cols-2" style="margin-top:10px">
            <div class="field"><label for="contact_phone">Contact #</label><input type="tel" id="contact_phone" name="contact_phone" placeholder="(xxx) xxx-xxxx"></div>
            <div class="field"><label for="emergency_phone">Emergency Contact #</label><input type="tel" id="emergency_phone" name="emergency_phone" placeholder="(xxx) xxx-xxxx"></div>
          </div>

           <div class="grid cols-2" style="margin-top:10px">
             <div class="field"><label for="last_bill_date">Last Bill Date</label><input type="date" id="last_bill_date" name="last_bill_date"></div>
             <div class="field"><label for="send_bill">Send Bill</label><input type="text" id="send_bill" name="send_bill" placeholder="Bill address or C/O"></div>
           </div>
        </div>

        <!-- Employment & Identification - Main Applicant -->
        <div class="section">
          <h2>Employment & Identification</h2>
           <div class="grid cols-2">
             <div class="field"><label for="employer_main">Employer</label><input type="text" id="employer_main" name="employer_main"></div>
             <div class="field"><label for="emp_phone_main">Emp. Phone</label><input type="tel" id="emp_phone_main" name="emp_phone_main" placeholder="(xxx) xxx-xxxx"></div>
           </div>
          <div class="grid cols-3" style="margin-top: 10px;">
             <div class="field"><label for="ssn_main">Social Security No</label><input type="text" id="ssn_main" name="ssn_main" maxlength="4" inputmode="numeric" pattern="[0-9]{4}" placeholder="XXXX"></div>
            <div class="field"><label for="id_no_main">I.D No</label><input type="text" id="id_no_main" name="id_no_main"></div>
            <div class="field"><label for="id_state_type">State/Type</label><input type="text" id="id_state_type" name="id_state_type"></div>
          </div>
          <div class="grid cols-2" style="margin-top: 10px;">
            <div class="field"><label for="id_exp_date_main">Exp Date</label><input type="date" id="id_exp_date_main" name="id_exp_date_main"></div>
          </div>
        </div>

        <!-- Employment & Identification - Spouse -->
        <div class="section">
          <h2>Employment & Identification - Spouse</h2>
          <div class="grid cols-3">
            <div class="field"><label for="spouse_employer">Spouse Employer</label><input type="text" id="spouse_employer" name="spouse_employer"></div>
            <div class="field"><label for="spouse_emp_phone">Emp. Phone</label><input type="tel" id="spouse_emp_phone" name="spouse_emp_phone" placeholder="(xxx) xxx-xxxx"></div>
            <div class="field"><label for="spouse_ssn">Social Security No</label><input type="text" id="spouse_ssn" name="spouse_ssn" placeholder="XXX-XX-XXXX"></div>
          </div>
          <div class="grid cols-2" style="margin-top: 10px;">
            <div class="field"><label for="spouse_id_no">I.D No</label><input type="text" id="spouse_id_no" name="spouse_id_no"></div>
            <div class="field"><label for="spouse_id_exp_date">Exp Date</label><input type="date" id="spouse_id_exp_date" name="spouse_id_exp_date"></div>
          </div>
        </div>

        <!-- Previous Address -->
        <div class="section">
          <h2>Previous Address</h2>
          <div class="grid">
            <div class="field">
              <label for="previous_address">Domicilio Anterior</label>
              <textarea id="previous_address" name="previous_address" placeholder="Street, City, State, ZIP"></textarea>
            </div>
          </div>
        </div>

        <!-- Deposit / Payment -->
        <div class="section">
          <h2>Deposit & Payment</h2>
          <div class="grid cols-3">
            <div class="field"><label for="deposit_amount">Deposit</label><input type="number" id="deposit_amount" name="deposit_amount" step="0.01" value="150"></div>
             <div class="field">
               <label>Payment Method</label>
               <div class="inline">
                 <label class="chip"><input type="checkbox" id="payment_method_cash" name="payment_method_cash" value="yes"> Cash</label>
                 <label class="chip"><input type="checkbox" id="payment_method_check" name="payment_method_check" value="yes"> Check</label>
               </div>
             </div>
            <div class="field"><label for="check_number">Check #</label><input type="text" id="check_number" name="check_number" placeholder="If paid by check"></div>
          </div>
          <div class="inline" style="margin-top: 10px;">
            <span class="muted">Deposit Type:</span>
            <label class="chip"><input type="checkbox" id="deposit_type_establish" name="deposit_type_establish" value="yes"> Re-establish Credit deposit</label>
            <label class="chip"><input type="checkbox" id="deposit_type_initial" name="deposit_type_initial" value="yes"> Initial Deposit</label>
          </div>
        </div>

        <!-- Work Order & Reads -->
        <div class="section">
          <h2>Work Order & Reads</h2>
           <div class="inline">
             <label class="chip"><input type="checkbox" id="wo" name="wo" value="yes"> W/O</label>
             <label class="chip"><input type="checkbox" id="connect" name="connect" value="yes"> Connect</label>
             <label class="chip"><input type="checkbox" id="disconnect" name="disconnect" value="yes"> Disconnect</label>
             <label class="chip"><input type="checkbox" id="receipt" name="receipt" value="yes"> Receipt</label>
             <label class="chip"><input type="checkbox" id="refund_wo" name="refund_wo" value="yes"> Refund W/O</label>
           </div>
           <div class="inline" style="margin-top:10px">
             <label class="chip"><input type="checkbox" id="install_new_service" name="install_new_service" value="yes"> INSTALL NEW SERVICE</label>
             <label class="chip"><input type="checkbox" id="install_meter" name="install_meter" value="yes"> INSTALL METER</label>
             <label class="chip"><input type="checkbox" id="read_and_turn_on" name="read_and_turn_on" value="yes"> READ AND TURN ON</label>
           </div>
          <div class="grid cols-3" style="margin-top:10px">
            <div class="field"><label for="last_read">Last Read</label><input type="number" id="last_read" name="last_read" step="1"></div>
            <div class="field"><label for="current_read">Current Read</label><input type="number" id="current_read" name="current_read" step="1"></div>
            <div class="field"><label for="refund_issued">Refund Issued $</label><input type="number" id="refund_issued" name="refund_issued" step="0.01"></div>
          </div>
           <div class="grid cols-3" style="margin-top:10px">
             <div class="field"><label for="form_date">Date</label><input type="date" id="form_date" name="form_date"></div>
             <div class="field"><label for="notes">Notes (optional)</label><input type="text" id="notes" name="notes" placeholder="Any additional details"></div>
             <div class="field"><label for="remarks">Remarks</label><input type="text" id="remarks" name="remarks" placeholder="Additional remarks"></div>
           </div>
           <div class="grid cols-1" style="margin-top:10px">
             <div class="field"><label for="comments">Comments</label><input type="text" id="comments" name="comments" value="VERIFIED ID"></div>
           </div>
        </div>


        <!-- Submit -->
        <button type="submit" class="submit-btn">Submit</button>
      </form>

      <!-- Thank you state (unchanged) -->
      <div id="thankYouMessage" class="thank-you">
        <h2>Thank you!</h2>
        <p>Your form has been submitted successfully.</p>
        <button id="downloadBtn" class="download-btn" onclick="downloadPDF()">Download PDF</button>
      </div>
    </div>
  </div>

  <!-- Field Menu Overlay and Modal -->
  <div id="fieldMenuOverlay" class="field-menu-overlay"></div>
  <div id="fieldMenu" class="field-menu">
    <div class="field-menu-header">
      <h3 class="field-menu-title">Form Fields</h3>
      <button class="field-menu-close" onclick="closeFieldMenu()">&times;</button>
    </div>
    <div class="field-menu-search">
      <input type="text" id="fieldSearch" placeholder="Search fields..." autocomplete="off">
    </div>
    <div id="fieldList" class="field-list">
      <!-- Field items will be populated by JavaScript -->
    </div>
  </div>

  <script>
    // Auto-fill today's date when page loads
    document.addEventListener('DOMContentLoaded', function() {
      const dateInput = document.getElementById('date_called');
      if (dateInput) {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        dateInput.value = `${year}-${month}-${day}`;
      }
      
      // Set up hidden textbox functionality for radio buttons and checkboxes
      setupHiddenTextboxes();
      
       // Set up deposit type mutual exclusivity
       setupDepositTypeExclusivity();
       
       // Set up payment method mutual exclusivity
       setupPaymentMethodExclusivity();
       
       // Set up full service address
       updateFullServiceAddress();
    });

    // Hidden textbox functionality
    function setupHiddenTextboxes() {
      // Handle radio buttons
      const radioButtons = document.querySelectorAll('input[type="radio"]');
      radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.checked) {
            createHiddenTextbox(this.name, this.value, this.nextSibling.textContent.trim());
          }
        });
      });

       // Handle checkboxes (excluding payment method checkboxes which have custom handling)
       const checkboxes = document.querySelectorAll('input[type="checkbox"]:not([id^="payment_method_"])');
       checkboxes.forEach(checkbox => {
         checkbox.addEventListener('change', function() {
           if (this.checked) {
             createHiddenTextbox(this.name, this.value, this.nextSibling.textContent.trim());
           } else {
             removeHiddenTextbox(this.name + '_textbox');
           }
         });
       });
    }

    function createHiddenTextbox(name, value, text) {
      const textboxId = name + '_textbox';
      
      // Remove existing textbox if it exists
      removeHiddenTextbox(textboxId);
      
      // Create new hidden textbox
      const textbox = document.createElement('input');
      textbox.type = 'hidden';
      textbox.id = textboxId;
      textbox.name = textboxId;
      textbox.value = text; // Use the display text, not the value
      
      // Add to form
      document.getElementById('customForm').appendChild(textbox);
      
      console.log(`Created hidden textbox: ${textboxId} with value: "${text}"`);
    }

    function removeHiddenTextbox(textboxId) {
      const existingTextbox = document.getElementById(textboxId);
      if (existingTextbox) {
        existingTextbox.remove();
        console.log(`Removed hidden textbox: ${textboxId}`);
      }
    }

     // Deposit type mutual exclusivity
     function setupDepositTypeExclusivity() {
       const depositTypeCheckboxes = [
         document.getElementById('deposit_type_establish'),
         document.getElementById('deposit_type_initial')
       ];

       depositTypeCheckboxes.forEach(checkbox => {
         if (checkbox) {
           checkbox.addEventListener('change', function() {
             if (this.checked) {
               // Uncheck the other deposit type checkbox
               depositTypeCheckboxes.forEach(otherCheckbox => {
                 if (otherCheckbox !== this && otherCheckbox.checked) {
                   otherCheckbox.checked = false;
                   // Remove the hidden textbox for the unchecked option
                   removeHiddenTextbox(otherCheckbox.name + '_textbox');
                 }
               });
             }
           });
         }
       });
     }

     // Payment method mutual exclusivity
     function setupPaymentMethodExclusivity() {
       const paymentMethodCheckboxes = [
         document.getElementById('payment_method_cash'),
         document.getElementById('payment_method_check')
       ];

       paymentMethodCheckboxes.forEach(checkbox => {
         if (checkbox) {
           checkbox.addEventListener('change', function() {
             if (this.checked) {
               // Uncheck the other payment method checkbox
               paymentMethodCheckboxes.forEach(otherCheckbox => {
                 if (otherCheckbox !== this && otherCheckbox.checked) {
                   otherCheckbox.checked = false;
                 }
               });
               
               // Create single payment_method_textbox with the selected value
               const textboxId = 'payment_method_textbox';
               const displayText = this.nextSibling.textContent.trim();
               createHiddenTextbox('payment_method', this.value, displayText);
             } else {
               // If this checkbox is unchecked, remove the payment method textbox
               removeHiddenTextbox('payment_method_textbox');
             }
           });
         }
       });
     }

     // Update full service address function
     function updateFullServiceAddress() {
       const street = document.getElementById('service_street').value || '';
       const city = document.getElementById('service_city').value || '';
       const state = document.getElementById('service_state').value || '';
       
       // Combine the address parts
       const fullAddress = [street, city, state].filter(part => part.trim()).join(', ');
       
       // Create or update the hidden textbox
       let hiddenField = document.getElementById('full_service_address');
       if (!hiddenField) {
         hiddenField = document.createElement('input');
         hiddenField.type = 'hidden';
         hiddenField.id = 'full_service_address';
         hiddenField.name = 'full_service_address';
         document.getElementById('customForm').appendChild(hiddenField);
       }
       
       hiddenField.value = fullAddress;
       console.log(`Updated full service address: "${fullAddress}"`);
     }

    // Example fill function
    function fillExampleData() {
      // Header fields
      document.getElementById('date_wanted').value = '2024-01-20';
      document.getElementById('account_number').value = '123456789';
      document.getElementById('wo_number').value = 'WO-2024-001';
       document.getElementById('cycle_number').value = '3';
       document.getElementById('clerks_name').value = 'Cynthia';

      // Contract Relationship
      document.getElementById('owner').checked = true;

       // Service Address & Type
       document.getElementById('service_street').value = '123 Main Street';
       document.getElementById('service_city').value = 'SALINAS';
       document.getElementById('service_state').value = 'CA';
       document.getElementById('service_type_residential_single').checked = true;
       
       // Update full service address after filling the fields
       updateFullServiceAddress();

      // Occupancy Documents
      document.getElementById('doc_rental').checked = true;

      // Customer
      document.getElementById('first_name').value = 'John';
      document.getElementById('middle_ex').value = 'A';
      document.getElementById('last_name').value = 'Smith';
      document.getElementById('verify_cadl').value = 'DL123456789';
      document.getElementById('last4_ssn').value = '1234';
      document.getElementById('connect_date').value = '2024-01-15';
      document.getElementById('last_bill').checked = true;
      document.getElementById('last_bill_dow_mon').checked = true;
       document.getElementById('contact_phone').value = '(555) 123-4567';
       document.getElementById('emergency_phone').value = '(555) 987-6543';
       document.getElementById('last_bill_date').value = '2024-01-01';
       document.getElementById('send_bill').value = '123 Main Street, Salinas, CA 93901';

       // Employment & Identification - Main Applicant
       document.getElementById('employer_main').value = 'ABC Company';
       document.getElementById('emp_phone_main').value = '(555) 234-5678';
      document.getElementById('ssn_main').value = '6789';
      document.getElementById('id_no_main').value = 'DL123456789';
      document.getElementById('id_state_type').value = 'CA/Driver License';
      document.getElementById('id_exp_date_main').value = '2029-01-15';

      // Employment & Identification - Spouse
      document.getElementById('spouse_employer').value = 'XYZ Corporation';
      document.getElementById('spouse_emp_phone').value = '(555) 345-6789';
      document.getElementById('spouse_ssn').value = '987-65-4321';
      document.getElementById('spouse_id_no').value = 'DL987654321';
      document.getElementById('spouse_id_exp_date').value = '2028-06-20';

      // Previous Address
      document.getElementById('previous_address').value = '456 Oak Avenue, Previous City, CA 90211';

      // Deposit & Payment
      document.getElementById('deposit_amount').value = '150.00';
      document.getElementById('payment_method_cash').checked = true;
       document.getElementById('check_number').value = '1234';
      document.getElementById('deposit_type_initial').checked = true;

       // Work Order & Reads
       document.getElementById('wo').checked = true;
       document.getElementById('connect').checked = true;
       document.getElementById('receipt').checked = true;
       document.getElementById('install_new_service').checked = true;
       document.getElementById('install_meter').checked = true;
       document.getElementById('read_and_turn_on').checked = true;
      document.getElementById('last_read').value = '12345';
      document.getElementById('current_read').value = '12450';
       document.getElementById('refund_issued').value = '0.00';
       document.getElementById('form_date').value = '2024-01-15';
       document.getElementById('notes').value = 'Standard connection setup';
       document.getElementById('remarks').value = 'All systems operational';
       document.getElementById('comments').value = 'VERIFIED ID';


      // Trigger hidden textbox creation for selected options
      const selectedRadios = document.querySelectorAll('input[type="radio"]:checked');
      selectedRadios.forEach(radio => {
        const event = new Event('change');
        radio.dispatchEvent(event);
      });

      const selectedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      selectedCheckboxes.forEach(checkbox => {
        const event = new Event('change');
        checkbox.dispatchEvent(event);
      });

      console.log('Form filled with example data');
    }

    // Form submission handler (kept as-is)
    function handleSubmit(event) {
      event.preventDefault();
      document.getElementById('customForm').style.display = 'none';
      document.getElementById('thankYouMessage').style.display = 'block';
      return false;
    }

    // PDF download function - downloads both form1.pdf and form2.pdf
    async function downloadPDF() {
      const downloadBtn = document.getElementById('downloadBtn');
      const originalText = downloadBtn.textContent;
      try{
        downloadBtn.textContent='Processing...';
        downloadBtn.disabled=true;

        const formData = new FormData(document.getElementById('customForm'));
        
        // Debug: Log all form data being sent
        console.log('Form data being sent to PDF:');
        for (let [key, value] of formData.entries()) {
          console.log(`${key}: ${value}`);
        }
        
        // Ensure all checkboxes and radios are properly included
        const allInputs = document.querySelectorAll('input, textarea, select');
        allInputs.forEach(input => {
          if (input.type === 'checkbox' || input.type === 'radio') {
            if (input.checked) {
              formData.set(input.name, input.value);
              console.log(`Added checked ${input.type}: ${input.name} = ${input.value}`);
            }
          } else if (input.type === 'hidden') {
            formData.set(input.name, input.value);
            console.log(`Added hidden field: ${input.name} = ${input.value}`);
          } else if (input.name === 'deposit_amount') {
            // Add dollar sign prefix to deposit amount
            const depositValue = input.value ? `$${input.value}` : input.value;
            formData.set(input.name, depositValue);
            console.log(`Added deposit amount with $ prefix: ${input.name} = ${depositValue}`);
          }
        });
        
        // Download form1.pdf
        downloadBtn.textContent='Downloading form1.pdf...';
        const response1 = await fetch('/edit_pdf?pdf=form1', { method:'POST', body:formData });
        if(!response1.ok) throw new Error('Server error: '+response1.status);

        const blob1 = await response1.blob();
        const url1 = URL.createObjectURL(blob1);
        const a1 = document.createElement('a');
        a1.href=url1; a1.download='form1.pdf';
        document.body.appendChild(a1); a1.click(); document.body.removeChild(a1);
        URL.revokeObjectURL(url1);

        // Download form2.pdf
        downloadBtn.textContent='Downloading form2.pdf...';
        const response2 = await fetch('/edit_pdf?pdf=form2', { method:'POST', body:formData });
        if(!response2.ok) throw new Error('Server error: '+response2.status);

        const blob2 = await response2.blob();
        const url2 = URL.createObjectURL(blob2);
        const a2 = document.createElement('a');
        a2.href=url2; a2.download='form2.pdf';
        document.body.appendChild(a2); a2.click(); document.body.removeChild(a2);
        URL.revokeObjectURL(url2);

        downloadBtn.textContent='Downloads Complete!';
        setTimeout(()=>{ downloadBtn.textContent=originalText; downloadBtn.disabled=false; }, 2000);
      }catch(err){
        console.error('Error downloading PDF:', err);
        downloadBtn.textContent='Error - Try Again';
        downloadBtn.disabled=false;
        setTimeout(()=>{ downloadBtn.textContent=originalText; }, 2000);
      }
    }

    // Field Menu Functionality
    let ctrlPressed = false;
    let shiftPressed = false;

    // Track key states
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Control') {
        ctrlPressed = true;
      }
      if (event.key === 'Shift') {
        shiftPressed = true;
      }
      
      // Check for Ctrl+Shift combination
      if (ctrlPressed && shiftPressed) {
        event.preventDefault();
        showFieldMenu();
      }
    });

    document.addEventListener('keyup', function(event) {
      if (event.key === 'Control') {
        ctrlPressed = false;
      }
      if (event.key === 'Shift') {
        shiftPressed = false;
      }
    });

    function showFieldMenu() {
      const overlay = document.getElementById('fieldMenuOverlay');
      const menu = document.getElementById('fieldMenu');
      const fieldList = document.getElementById('fieldList');
      const searchInput = document.getElementById('fieldSearch');
      
      // Clear existing content
      fieldList.innerHTML = '';
      
      // Get all input fields with IDs
      const inputs = document.querySelectorAll('input[id], textarea[id], select[id]');
      
      if (inputs.length === 0) {
        fieldList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No input fields found</div>';
      } else {
        // Store all field items for filtering
        window.allFieldItems = [];
        
        inputs.forEach(input => {
          const fieldItem = document.createElement('div');
          fieldItem.className = 'field-item';
          
          // Get field label
          const label = document.querySelector(`label[for="${input.id}"]`);
          const labelText = label ? label.textContent.trim() : 'No label';
          
          // Get field type
          const fieldType = input.type || input.tagName.toLowerCase();
          
          fieldItem.innerHTML = `
            <div>
              <span class="field-id">
                ${input.id}
                <span class="copy-tooltip">Click to copy</span>
              </span>
              <span class="field-label">${labelText}</span>
            </div>
            <span class="field-type">${fieldType}</span>
          `;
          
          // Wire the copy handler for the entire field item
          fieldItem.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();           // stop any parent click handlers
            copyFieldId(input.id, e);
          });
          
          // Store field data for search
          fieldItem.fieldData = {
            id: input.id,
            label: labelText,
            type: fieldType
          };
          
          fieldList.appendChild(fieldItem);
          window.allFieldItems.push(fieldItem);
        });
      }
      
      // Set up search functionality
      searchInput.value = '';
      searchInput.addEventListener('input', filterFields);
      
      // Show menu
      overlay.classList.add('show');
      menu.classList.add('show');
      
      // Focus search input
      setTimeout(() => searchInput.focus(), 100);
      
      // Close on overlay click
      overlay.addEventListener('click', closeFieldMenu);
      
      // Close on Escape key
      document.addEventListener('keydown', function escapeHandler(event) {
        if (event.key === 'Escape') {
          closeFieldMenu();
          document.removeEventListener('keydown', escapeHandler);
        }
      });
    }

    function filterFields() {
      const searchTerm = document.getElementById('fieldSearch').value.toLowerCase();
      const fieldList = document.getElementById('fieldList');
      
      if (!window.allFieldItems) return;
      
      // Clear the list
      fieldList.innerHTML = '';
      
      // Filter and show matching items
      const filteredItems = window.allFieldItems.filter(item => {
        const fieldData = item.fieldData;
        return fieldData.id.toLowerCase().includes(searchTerm) ||
               fieldData.label.toLowerCase().includes(searchTerm) ||
               fieldData.type.toLowerCase().includes(searchTerm);
      });
      
      if (filteredItems.length === 0) {
        fieldList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No fields match your search</div>';
      } else {
        filteredItems.forEach(item => {
          fieldList.appendChild(item);
        });
      }
    }

    function closeFieldMenu() {
      const overlay = document.getElementById('fieldMenuOverlay');
      const menu = document.getElementById('fieldMenu');
      
      overlay.classList.remove('show');
      menu.classList.remove('show');
      
      // Remove event listener
      overlay.removeEventListener('click', closeFieldMenu);
    }

    function copyFieldId(fieldId, e) {
      // guard & stop bubbling just in case
      if (e) { e.preventDefault(); e.stopPropagation(); }

      const fieldItem = e.currentTarget; // Now the field item itself is the target
      const idElement = fieldItem.querySelector('.field-id'); // Find the ID element within
      
      // Remove copied class from all other field items first
      const allFieldItems = document.querySelectorAll('.field-item.copied');
      allFieldItems.forEach(item => {
        if (item !== fieldItem) {
          item.classList.remove('copied');
        }
      });
      
      const doTooltip = (el, text) => {
        if (!el) return; // Guard against null element
        const tip = el.querySelector('.copy-tooltip');
        if (!tip) return;
        const original = tip.textContent;
        tip.textContent = text;
        tip.classList.add('show');
        setTimeout(() => {
          tip.classList.remove('show');
          setTimeout(() => { tip.textContent = original; }, 200);
        }, 1500);
      };

      const showCopiedFeedback = () => {
        // Add the copied class for visual feedback
        if (fieldItem) {
          fieldItem.classList.add('copied');
        }
        doTooltip(idElement, 'Copied!');
        
        // Remove the copied class after animation completes
        setTimeout(() => {
          if (fieldItem) {
            fieldItem.classList.remove('copied');
          }
        }, 2000);
      };

      // attempt modern clipboard first
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(fieldId)
          .then(() => showCopiedFeedback())
          .catch(() => fallback());
      } else {
        fallback();
      }

      function fallback() {
        const ta = document.createElement('textarea');
        ta.value = fieldId;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); } catch (_) {}
        document.body.removeChild(ta);
        showCopiedFeedback();
      }
    }
  </script>
</body>
</html>
