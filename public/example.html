<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Form</title>
    <style>
        input[type="text"], select {
            background-color: #e6f4ff;
            border: 2px solid #2980b9;
            border-radius: 10px;
            padding: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="text"]::placeholder, input[type="email"]::placeholder {
            text-align: center;
        }
        input[type="text"]:focus, select:focus {
            border-color: #1c598a;
            outline: none;
        }
        html, body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            font-family: 'Montserrat', sans-serif;
            color: #333;
            background-color: #f4f4f4;
        }
        header {
            background-color: #2c3e50;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }
        #box {
            border: 4px solid lightblue;
            border-color: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin: 50px;
            background-color: #ffffff;
            width: auto;
            height: auto;
            position: relative;
        }
        .section { display: none; }
        .section.active { display: block; }
        .thank-you-message { display: none; font-size: 20px; font-weight: bold; text-align: center; margin-top: 20px; }
        nav {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        nav a {
            color: #ffffff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        nav a:hover {
            color: #2980b9;
        }
        section {
            padding: 50px;
            text-align: center;
            flex: 1;
            display: grid;
            gap: 20px;
        }
        footer {
            text-align: center;
            padding: 20px;
            background-color: #2c3e50;
            color: white;
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 10px;
            }
            nav {
                position: static;
                transform: none;
                margin-top: 10px;
            }
            .steps {
                grid-template-columns: 1fr;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
<header>
    <img src="logo.png" alt="FormWiz Logo" width="130" height="80" onclick="location.href='index.html';">
    <nav>
        <a href="index.html">Home</a>
        <a href="forms.html">Forms</a>
        <a href="contact.html">Contact Us</a>
    </nav>
</header>

<div id="pdfPreview" style="display:none;">
    <iframe id="pdfFrame" style="display:none"></iframe>
</div>    
<input type="text" id="current_date" name="current_date" placeholder="current_date" style="display:none">    
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

<div id="questions">
    <div id="result"></div>
    <section>
        <div id="box">
            <form id="customForm" onsubmit="return handleSubmit('section1');">
                <div id="section1" class="section active">
                    <h2>Section 1</h2>
                    <div id="question-container-1">
                        <label><h3>q1</h3></label>
                        <input type="text" id="answer1" name="answer1" placeholder="">
                    </div>
                    <br><br>
                    <div class="navigation-buttons">
                        <button type="submit">Submit</button>
                    </div>
                </div>
                <div id="hidden_pdf_fields"></div>
            </form>
            <div id="thankYouMessage" class="thank-you-message">Thank you for completing the survey</div>
        </div>
    </section>
</div>

<footer>
    &copy; 2024 FormWiz. All rights reserved.
</footer>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyDS-tSSn7fdLBgwzfHQ_1MPG1w8S_4qb04",
    authDomain: "formwiz-3f4fd.firebaseapp.com",
    projectId: "formwiz-3f4fd",
    storageBucket: "formwiz-3f4fd.appspot.com",
    messagingSenderId: "404259212529",
    appId: "1:404259212529:web:15a33bce82383b21cfed50",
    measurementId: "G-P07YEN0HPD"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Assuming user is logged in and we have their userId
let userId = null;

// Check for user authentication state and set userId
firebase.auth().onAuthStateChanged(user => {
    if (user) {
        userId = user.uid;
        loadFormData('section1');  // Load data for section 1 on page load
        autoSaveForm('section1');  // Enable auto-saving
    } else {
        console.log("User not logged in.");
    }
});

// Save form data to Firestore
function saveFormData(sectionId) {
    const formData = {};
    const inputs = document.querySelectorAll(`#${sectionId} input, #${sectionId} select`);
    inputs.forEach(input => {
        formData[input.name] = input.type === 'checkbox' ? input.checked : input.value;
    });

    db.collection('users').doc(userId).collection('formAnswers').doc(sectionId).set(formData)
    .then(() => {
        console.log('Form data saved successfully.');
    })
    .catch(error => {
        console.error('Error saving form data: ', error);
    });
}

// Load saved form data from Firestore
function loadFormData(sectionId) {
    db.collection('users').doc(userId).collection('formAnswers').doc(sectionId).get()
    .then(doc => {
        if (doc.exists) {
            const savedData = doc.data();
            for (const [key, value] of Object.entries(savedData)) {
                const input = document.querySelector(`[name="${key}"]`);
                if (input) {
                    if (input.type === 'checkbox') {
                        input.checked = value;
                    } else {
                        input.value = value;
                    }
                }
            }
            console.log('Form data loaded successfully.');
        } else {
            console.log('No saved form data found.');
        }
    })
    .catch(error => {
        console.error('Error loading form data: ', error);
    });
}

// Auto-save form data in real-time
function autoSaveForm(sectionId) {
    const inputs = document.querySelectorAll(`#${sectionId} input, #${sectionId} select`);
    inputs.forEach(input => {
        input.addEventListener('change', () => saveFormData(sectionId));
    });
}

// Handle form submission
function handleSubmit(sectionId) {
    saveFormData(sectionId);
    showThankYouMessage();
    return false;  // Prevent actual form submission
}

function showThankYouMessage() {
    document.getElementById('customForm').style.display = 'none';
    document.getElementById('thankYouMessage').style.display = 'block';
}
</script>
</body>
</html>
